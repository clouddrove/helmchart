name: Helm Template Run

permissions:
  contents: read
  pull-requests: write

on: [pull_request]

jobs:
  helm-template:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Helm
        uses: azure/setup-helm@v4
        with:
          version: v3.14.0

      - name: Helm template all charts
        run: |
          set -e

          GREEN='\033[0;32m'
          BLUE='\033[0;34m'
          YELLOW='\033[1;33m'
          RED='\033[0;31m'
          NC='\033[0m' # No Color

          for chart in charts/*; do
            if [ -f "$chart/Chart.yaml" ]; then
              echo -e "${BLUE}==================================================${NC}"
              echo -e "${GREEN}ðŸš€ Helm Chart: ${chart}${NC}"
              echo -e "${BLUE}==================================================${NC}"

              echo -e "${YELLOW}â–¶ Helm template (default values)${NC}"
              helm template test "$chart"

              if [ -f "$chart/config/override-values.yaml" ]; then
                echo -e "${YELLOW}â–¶ Helm template (override-values.yaml)${NC}"
                helm template test "$chart" -f "$chart/config/override-values.yaml"
              else
                echo -e "${RED}âš  No override-values.yaml found${NC}"
              fi
            fi
          done
