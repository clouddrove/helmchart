{{- if .Values.externalSecrets.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "adrija.fullname" . }}-secret
  labels:
    {{- include "adrija.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStore }}
    kind: SecretStore
  target:
    name: {{ include "adrija.fullname" . }}-secret
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        slack-bot-token: "{{ "{{" }} .slack_bot_token {{ "}}" }}"
        slack-app-token: "{{ "{{" }} .slack_app_token {{ "}}" }}"
        {{- if .Values.aiProviders.enableGemini }}
        gemini-api-key: "{{ "{{" }} .gemini_api_key {{ "}}" }}"
        {{- end }}
        {{- if .Values.aiProviders.enableClaude }}
        anthropic-api-key: "{{ "{{" }} .anthropic_api_key {{ "}}" }}"
        {{- end }}
        {{- if .Values.aiProviders.enableOpenAI }}
        openai-api-key: "{{ "{{" }} .openai_api_key {{ "}}" }}"
        {{- end }}
  data:
  # Slack Configuration
  - secretKey: slack_bot_token
    remoteRef:
      key: {{ .Values.externalSecrets.vault }}/{{ .Values.externalSecrets.item }}
      property: slack_bot_token
  - secretKey: slack_app_token
    remoteRef:
      key: {{ .Values.externalSecrets.vault }}/{{ .Values.externalSecrets.item }}
      property: slack_app_token
  # AI Provider API Keys
  {{- if .Values.aiProviders.enableGemini }}
  - secretKey: gemini_api_key
    remoteRef:
      key: {{ .Values.externalSecrets.vault }}/{{ .Values.externalSecrets.item }}
      property: gemini_api_key
  {{- end }}
  {{- if .Values.aiProviders.enableClaude }}
  - secretKey: anthropic_api_key
    remoteRef:
      key: {{ .Values.externalSecrets.vault }}/{{ .Values.externalSecrets.item }}
      property: anthropic_api_key
  {{- end }}
  {{- if .Values.aiProviders.enableOpenAI }}
  - secretKey: openai_api_key
    remoteRef:
      key: {{ .Values.externalSecrets.vault }}/{{ .Values.externalSecrets.item }}
      property: openai_api_key
  {{- end }}
{{- end }}

